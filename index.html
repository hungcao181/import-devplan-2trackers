<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Import development plan into trackers!</title>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/latest/css/bootstrap.min.css">
    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/latest/css/bootstrap-theme.min.css">    

    <link rel="stylesheet" href="./style.css">
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>Turn slog into fun!</h1>
        <div id="root"></div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">
          <label>
            <input type="radio" name="tracker" value="1" id="radtracker1" checked>
            Pivotal Tracker
          </label>
        </div>
        <!--radtracker1 class here is used to reference to radio button above-->
        <div class="panel-content radtracker1" name="trackerpanel">
          <form class="form-horizontal">
            <div class="form-group">
              <label for="prjid" class="col-sm-3 control-label"> Project ID</label>
              <div class="col-sm-9">
                <input type="text" id="prjid" value="1482424" class="form-control">
              </div>
            </div>
            <div class="form-group">
              <label for="pttoken" class="col-sm-3 control-label"> API Token</label>
              <div class="col-sm-9">
                <input type="text" id="pttoken" value="1325f5fb60814d699f4bf40f62dabffd" class="form-control">
                <p class="form-control-static">Don't know where to get the token? <a href="#" id="getpttoken">Find at bottom of this page</a></p>
              </div>
            </div>
          </form>
        </div>
      </div>

      <div class="panel panel-default">
        <div class="panel-heading">
          <label>
            <!--id here is used for reference purpose-->
            <input type="radio" name="tracker" value="2" id="radtracker2">
            Gitlab
          </label>
        </div>
        <!--radtracker2 class here is used to reference to radio button above-->
        <div class="panel-content hidden radtracker2" name="trackerpanel">
          <form class="form-horizontal">
            <div class="form-group">
              <label for="prjname" class="col-sm-3 control-label">Project</label>
              <div class="col-sm-9">
                <input type="text" id="prjname" placeholder="pear/myblog" class="form-control" value="hungcao181/dmz">
              </div>
            </div>
            <div class="form-group">            
              <label for="gitlabtoken" class="col-sm-3 control-label"> Private Token</label>
              <div class="col-sm-9">
                <input type="text" id="privatetoken" class="form-control" value="-EKo1s-MGxi3wy3dsG6Z">
                <p class="form-control-static">Don't have a token yet? <a href="#" id="getgitlabtoken">Get new one here</a></p>
              </div>
              
            </div>
            <div class="form-group hidden">
              <label for="apiversion" class="col-sm-3 control-label">API Version</label> 
              <div class="col-sm-9">
                <input type="text" id="apiversion" value="/api/v3" class="form-control">
              </div>
            </div>
            <div class="form-group hidden">
              <label for="hostname" class="col-sm-3 control-label">Host Name</label>
              <div class="col-sm-9">
                <input type="text" id="hostname" value="gitlab.com" class="form-control">
              </div>
            </div>
            <div class="form-group">
              <label for="sefthosted" class="col-sm-3 control-label">Selfhosted? Domain</label>
              <div class="col-sm-9">
                <input type="text" id="selfhosted" placeholder="gitlab.asoft-python.com" class="form-control">
              </div>
            </div>
          </form>
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">
          Your development plan here
        </div>
        <div class="panel-content">
          <textarea rows="15" cols="50" id="data" class="form-control">
SPRINT #1

EPIC:Analysis n Plan
Developer analyze business requirements 
Developer identify gaps in business requirements 
Client clarify gaps in business requirements 
Developer identify technical risks and solutions 
Developer finalize development plan 
Developer or Client provide access to project tracking 
Developer initialize project tracking tool with the finalized development plan 
Developer setup IM chat channel for daily communication 

EPIC:Infrastructure
Client provides access to source code repository 
Developer setups development and staging environment 
Developer initializes source code repository 
Developer integrates key front-end frameworks required for the project 
Client provides art assets provide art assets

SPRINT #2
Epic: settings management
user choose service to work with (Pivotal tracker / Gitlab.com / SelfHosted Gitlab)
user input setting for selected tracker

Epic: Data management
user load stories from file
user input/update stories on text area
user save stories into file

Epic: Push to remote trackers 
user push data to Pivotal tracker
user push data to Gitlab

SPRINT #3
Epic: settings management (continued)
user load current settings of Pivotal from local storage
user load current settings of Gitlab from local storage
user save settings of Pivotal
user save setting of Gitlab

Epic: Enhancement
Fix gitlab label existing issue
Show the importing progress
user get access using user/pass instead of token
          </textarea>
          <p id="working-file" class="form-control-static"></p>
          <p><span id="importstatus" class="label label-success"></span></p>
          
        </div>
      </div>

      <div id="primary-actions">
        <div class="btn-group btn-group-justified" role="group">
          <div class="btn-group">
            <button id="load-button" type="button" class="btn btn-default"> Load data </button>
          </div>
          <div class="btn-group">
            <button id="save-button" type="button" class="btn btn-info"> Save </button>
          </div>
          <div class="btn-group">
            <button id="saveas-button" type="button" class="btn btn-primary"> Save as </button>
          </div>
          <div class="btn-group">
            <button id="push-button" type="button" class="btn btn-danger">Push to Tracker</button>
          </div>
        </div>
        <a href="#" class="pull-right">Power by Electron</a>
      </div>

    </div>
  </body>
  <script>
    // You can also require other files to run in this process
    require('./importer/renderer.js');
    let importer = require('./importer/index.js');
    let tracker = 1;
    const ipc = require('electron').ipcRenderer;    
    const shell = require('electron').shell

    document.addEventListener('DOMContentLoaded', function() {
      console.log("ready");

      //inform the ready status to main (to load current setting) 
      ipc.send('document-ready');

      let pushButton = document.getElementById("push-button");
      pushButton.addEventListener("click", (e) => {
        let options = {pivotaltracker:{}, gitlab:{}};
        options.tracker = tracker;
        options.data = document.getElementById("data").value;
        options.ipc = ipc;
        switch (options.tracker) {
          case 1: //pivotal tracker
            options.pivotaltracker.project = document.getElementById("prjid").value;
            options.pivotaltracker.apitoken = document.getElementById("pttoken").value;
            break;
          case 2: //gitlab
            options.gitlab.project = document.getElementById("prjname").value;
            console.log("get project ", options.gitlab.project);
            options.gitlab.privatetoken = document.getElementById("privatetoken").value;
            options.gitlab.apiversion = document.getElementById("apiversion").value;
            options.gitlab.hostname = document.getElementById("hostname").value;
            options.gitlab.selfhosted = document.getElementById("selfhosted").value;
            break;
        }
        // ipc.send('doimport', options);
        importer(options);
      });

      document.getElementById("getpttoken").addEventListener('click', (e) => {
        shell.openExternal('https://www.pivotaltracker.com/profile');
      });

      document.getElementById("getgitlabtoken").addEventListener('click', (e) => {
        shell.openExternal('https://gitlab.com/profile/personal_access_tokens');
      });

      //hide/show the un/selected tracker panel content
      //set global tracker variant according to selected tracker tool
      let trackers = document.getElementsByName("tracker");
      for (i=0;i<trackers.length; i++) {
        trackers[i].addEventListener('click', (e) => {
          let trackerpanels = document.getElementsByName("trackerpanel");
          for (j=0;j<trackerpanels.length;j++) {
            //the panel content must contain a class that match relevant radio's id
            if (trackerpanels[j].classList.contains(e.target.id)) {
              trackerpanels[j].classList.remove("hidden");
              tracker = Number(e.target.value);
              console.log("tracker ", tracker);
            } else trackerpanels[j].classList.add("hidden");
          }
        })
      }

    });

  </script>
</html>
