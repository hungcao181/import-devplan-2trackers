<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Import development plan into trackers!</title>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/latest/css/bootstrap.min.css">
    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/latest/css/bootstrap-theme.min.css">    

    <link rel="stylesheet" href="./style.css">
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>Turn slog into fun!</h1>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">
          <label>
            <input type="radio" name="tracker" value="1" id="radtracker1" checked>
            Pivotal Tracker
          </label>
        </div>
        <!--radtracker1 class here is used to reference to radio button above-->
        <div class="panel-content radtracker1" name="trackerpanel">        
          <label for="prjid"> Project ID:</label><input type="text" id="prjid" class="form-control">
          <label for="pttoken"> API Token:</label><input type="text" id="pttoken" class="form-control">
        </div>
      </div>

      <div class="panel panel-default">
        <div class="panel-heading">
          <label>
            <!--id here is used for reference purpose-->
            <input type="radio" name="tracker" value="2" id="radtracker2">
            Gitlab
          </label>
        </div>
        <!--radtracker2 class here is used to reference to radio button above-->
        <div class="panel-content hidden radtracker2" name="trackerpanel">
          <label for="prjname">Project space/project name:</label>
          <input type="text" id="prjname" placeholder="pear/myblog" class="form-control" value="hungcao181/dmz">
          <label for="gitlabtoken"> Private Token:</label>
          <input type="text" id="privatetoken" class="form-control" value="-EKo1s-MGxi3wy3dsG6Z">
          <label for="apiversion">API Version:</label> 
          <input type="text" id="apiversion" value="/api/v3" class="form-control">
          <label for="hostname">Host Name:</label>
          <input type="text" id="hostname" value="gitlab.com" class="form-control">
          <label for="sefthosted">Selfhosted Name:</label>
          <input type="text" id="selfhosted" placeholder="gitlab.asoft-python.com" class="form-control">
        </div>
      </div>
      <div class="panel panel-default">
        <div class="panel-heading">
          Your development plan here
        </div>
        <div class="panel-content">
          <textarea rows="15" cols="50" id="data" class="form-control">
SPRINT:#1

EPIC:Analysis n Plan
story:Developer analyze business requirements 
story:Developer identify gaps in business requirements 
story:Client clarify gaps in business requirements 
story:Developer identify technical risks and solutions 
story:Developer finalize development plan 
story:Developer or Client provide access to project tracking 
story:Developer initialize project tracking tool with the finalized development plan 
story:Developer setup IM chat channel for daily communication 

EPIC:Infrastructure
story:Client provides access to source code repository 
story:Developer setups development and staging environment 
story:Developer initializes source code repository 
story:Developer integrates key front-end frameworks required for the project 
story:Client provides art assets provide art assets

SPRINT:#2

          </textarea>
          <p id="working-file" class="form-control-static"></p>
        </div>
      </div>

      <div id="primary-actions">
        <div class="btn-group btn-group-justified" role="group">
          <div class="btn-group">
            <button id="load-button" type="button" class="btn btn-default"> Load data </button>
          </div>
          <div class="btn-group">
            <button id="save-button" type="button" class="btn btn-info"> Save </button>
          </div>
          <div class="btn-group">
            <button id="saveas-button" type="button" class="btn btn-primary"> Save as </button>
          </div>
          <div class="btn-group">
            <button id="push-button" type="button" class="btn btn-danger">Push to Tracker</button>
          </div>
        </div>
        <a href="#" class="pull-right">Power by Electron</a>
      </div>

    </div>
  </body>
  <script>
    // You can also require other files to run in this process
    require('./renderer.js');
    let importer = require('./importer.js');
    let tracker = 1;
    
    let pushButton = document.getElementById("push-button");
    pushButton.addEventListener("click", (e) => {
      let options = {pivotaltracker:{}, gitlab:{}};
      options.tracker = tracker;
      switch (options.tracker) {
        case 1: //pivotal tracker
          options.pivotaltracker.project = document.getElementById("prjid").value;
          options.pivotaltracker.apitoken = document.getElementById("pttoken").value;
          break;
        case 2: //gitlab
          options.gitlab.project = document.getElementById("prjname").value;
          console.log("get project ", options.gitlab.project);
          options.gitlab.privatetoken = document.getElementById("privatetoken").value;
          options.gitlab.apiversion = document.getElementById("apiversion").value;
          options.gitlab.hostname = document.getElementById("hostname").value;
          options.gitlab.selfhosted = document.getElementById("selfhosted").value;
          break;
      }
      importer(options);
    });

    //inform the ready status to main (to load current setting) 
    document.addEventListener('DOMContentLoaded', function() {
      console.log("ready");
      const ipc = require('electron').ipcRenderer;
      ipc.send('document-ready');
    });

    //hide/show the un/selected tracker panel content
    //set global tracker variant according to selected tracker tool
    let trackers = document.getElementsByName("tracker");
    for (i=0;i<trackers.length; i++) {
      trackers[i].addEventListener('click', (e) => {
        let trackerpanels = document.getElementsByName("trackerpanel");
        for (j=0;j<trackerpanels.length;j++) {
          //the panel content must contain a class that match relevant radio's id
          if (trackerpanels[j].classList.contains(e.target.id)) {
            trackerpanels[j].classList.remove("hidden");
            tracker = Number(e.target.value);
            console.log("tracker ", tracker);
          } else trackerpanels[j].classList.add("hidden");
        }
      })
    }
  </script>
</html>
